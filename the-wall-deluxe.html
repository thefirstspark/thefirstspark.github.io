<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>???</title>
    <link href="https://fonts.googleapis.com/css2?family=Permanent+Marker&family=Rock+Salt&family=Caveat:wght@700&family=Monoton&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            --glow1: rgba(255,0,150,0.04);
            --glow2: rgba(0,255,255,0.04);
        }
        
        body {
            background: #0a0a0a;
            min-height: 100vh;
            overflow-x: hidden;
            cursor: crosshair;
        }
        
        body.inverted {
            filter: invert(1) hue-rotate(180deg);
        }
        
        .wall {
            position: relative;
            min-height: 100vh;
            background: 
                repeating-linear-gradient(0deg, transparent, transparent 48px, #1a1a1a 48px, #1a1a1a 50px),
                repeating-linear-gradient(90deg, #121212, #121212 98px, #1a1a1a 98px, #1a1a1a 100px);
            background-size: 100px 50px;
            padding: 20px;
        }
        
        .wall::before {
            content: '';
            position: absolute;
            inset: 0;
            background: 
                radial-gradient(ellipse at 20% 30%, var(--glow1) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 70%, var(--glow2) 0%, transparent 50%);
            pointer-events: none;
            transition: opacity 0.5s;
        }
        
        .tags-container {
            position: relative;
            min-height: calc(100vh - 40px);
            z-index: 1;
        }
        
        .tag {
            position: absolute;
            font-family: 'Permanent Marker', cursive;
            text-shadow: 3px 3px 0 rgba(0,0,0,0.8), -1px -1px 0 rgba(255,255,255,0.1);
            opacity: 0.95;
            transition: transform 0.2s, text-shadow 0.2s;
            max-width: 280px;
            word-wrap: break-word;
            user-select: none;
        }
        
        .tag.fresh {
            animation: sprayIn 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        
        .tag.legendary {
            animation: legendary 2s ease-in-out infinite;
        }
        
        @keyframes sprayIn {
            0% { 
                opacity: 0; 
                transform: scale(0.3) rotate(var(--rot));
                filter: blur(8px);
            }
            50% {
                filter: blur(2px);
            }
            100% { 
                opacity: 0.95; 
                transform: scale(1) rotate(var(--rot));
                filter: blur(0);
            }
        }
        
        @keyframes legendary {
            0%, 100% { 
                text-shadow: 
                    3px 3px 0 rgba(0,0,0,0.8),
                    0 0 20px currentColor,
                    0 0 40px currentColor;
            }
            50% { 
                text-shadow: 
                    3px 3px 0 rgba(0,0,0,0.8),
                    0 0 30px currentColor,
                    0 0 60px currentColor,
                    0 0 80px currentColor;
            }
        }
        
        .tag:hover {
            transform: scale(1.05) rotate(var(--rot));
            text-shadow: 3px 3px 0 rgba(0,0,0,0.8), 0 0 25px currentColor;
            z-index: 100;
        }
        
        .drip {
            position: absolute;
            width: 3px;
            background: linear-gradient(to bottom, currentColor, transparent);
            opacity: 0.6;
            border-radius: 0 0 3px 3px;
            animation: dripDown 2s ease-in forwards;
        }
        
        @keyframes dripDown {
            from { height: 0; }
            to { height: var(--drip-height); }
        }
        
        .fresh-glow {
            position: absolute;
            inset: -10px;
            background: radial-gradient(circle, currentColor 0%, transparent 70%);
            opacity: 0.4;
            filter: blur(15px);
            animation: glowFade 3s ease-out forwards;
            pointer-events: none;
        }
        
        @keyframes glowFade {
            to { opacity: 0; }
        }
        
        .instructions {
            position: fixed;
            top: 15px;
            left: 50%;
            transform: translateX(-50%);
            color: #2a2a2a;
            font-family: monospace;
            font-size: 11px;
            transition: color 0.3s;
            z-index: 10;
        }
        .instructions:hover { color: #555; }
        
        .hint {
            position: fixed;
            bottom: 8px;
            right: 12px;
            color: #151515;
            font-size: 9px;
            font-family: monospace;
            transition: color 0.3s;
        }
        .hint:hover { color: #333; }
        
        .sigil {
            position: fixed;
            bottom: 40px;
            left: 15px;
            width: 35px;
            height: 35px;
            opacity: 0.04;
            transition: opacity 0.5s, transform 0.3s;
            cursor: pointer;
        }
        .sigil:hover { opacity: 0.25; transform: rotate(15deg); }
        .sigil.activated {
            opacity: 1 !important;
            animation: sigilPulse 0.5s ease-out;
        }
        
        @keyframes sigilPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.3); }
            100% { transform: scale(1); }
        }
        
        .secret-message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-family: 'Monoton', cursive;
            font-size: 2.5rem;
            color: #ff0096;
            text-shadow: 0 0 30px #ff0096, 0 0 60px #00ffff;
            opacity: 0;
            pointer-events: none;
            text-align: center;
            z-index: 3000;
            transition: opacity 0.5s;
            letter-spacing: 4px;
        }
        .secret-message.show {
            opacity: 1;
            animation: secretReveal 3s ease-out forwards;
        }
        
        @keyframes secretReveal {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
            20% { opacity: 1; transform: translate(-50%, -50%) scale(1.1); }
            30% { transform: translate(-50%, -50%) scale(1); }
            80% { opacity: 1; }
            100% { opacity: 0; }
        }
        
        .overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.75);
            z-index: 1500;
        }
        .overlay.active { display: block; }
        
        .modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(8,8,8,0.97);
            border: 1px solid #2a2a2a;
            padding: 30px;
            z-index: 2000;
            box-shadow: 0 0 60px rgba(255,0,150,0.25), inset 0 0 40px rgba(0,0,0,0.6);
            min-width: 320px;
        }
        .modal.active { display: block; animation: modalIn 0.15s ease-out; }
        
        @keyframes modalIn {
            from { opacity: 0; transform: translate(-50%, -50%) scale(0.95); }
            to { opacity: 1; transform: translate(-50%, -50%) scale(1); }
        }
        
        .modal h3 {
            font-family: 'Permanent Marker', cursive;
            color: #ff0096;
            margin-bottom: 20px;
            font-size: 1.3rem;
            letter-spacing: 1px;
        }
        
        .modal input {
            width: 100%;
            background: #000;
            border: 1px solid #2a2a2a;
            color: #fff;
            padding: 14px;
            font-family: 'Permanent Marker', cursive;
            font-size: 1.1rem;
            margin-bottom: 15px;
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        .modal input:focus {
            outline: none;
            border-color: #ff0096;
            box-shadow: 0 0 15px rgba(255,0,150,0.4);
        }
        
        .colors {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .color-btn {
            width: 28px;
            height: 28px;
            border: 2px solid transparent;
            cursor: pointer;
            transition: transform 0.15s, border-color 0.15s;
            position: relative;
        }
        .color-btn:hover, .color-btn.selected {
            transform: scale(1.25);
            border-color: #fff;
        }
        .color-btn.gold {
            background: linear-gradient(135deg, #ffd700, #ff8c00, #ffd700) !important;
            animation: goldShimmer 2s ease-in-out infinite;
        }
        .color-btn.gold::after {
            content: '‚òÖ';
            position: absolute;
            top: -8px;
            right: -8px;
            font-size: 10px;
            color: #ffd700;
        }
        
        @keyframes goldShimmer {
            0%, 100% { filter: brightness(1); }
            50% { filter: brightness(1.4); }
        }
        
        .spray-btn {
            background: linear-gradient(135deg, #ff0096, #00ffff);
            border: none;
            color: #000;
            padding: 12px 35px;
            font-family: 'Permanent Marker', cursive;
            font-size: 1rem;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            letter-spacing: 2px;
        }
        .spray-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 25px rgba(255,0,150,0.5);
        }
        .spray-btn:active {
            transform: scale(0.98);
        }
        
        .close-btn {
            position: absolute;
            top: 8px;
            right: 12px;
            background: none;
            border: none;
            color: #444;
            font-size: 1.6rem;
            cursor: pointer;
            line-height: 1;
        }
        .close-btn:hover { color: #ff0096; }
        
        .loading {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #ff0096;
            font-family: monospace;
            animation: pulse 1s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }
        
        .tag-count {
            position: fixed;
            bottom: 8px;
            left: 12px;
            color: #1a1a1a;
            font-family: monospace;
            font-size: 9px;
            transition: color 0.3s;
        }
        .tag-count:hover { color: #333; }
        
        /* Spray particles */
        .spray-particle {
            position: fixed;
            width: 4px;
            height: 4px;
            border-radius: 50%;
            pointer-events: none;
            z-index: 2500;
        }
        
        /* Sound toggle */
        .sound-toggle {
            position: fixed;
            top: 12px;
            right: 12px;
            background: none;
            border: 1px solid #222;
            color: #333;
            font-size: 16px;
            width: 32px;
            height: 32px;
            cursor: pointer;
            opacity: 0.3;
            transition: opacity 0.3s, border-color 0.3s;
            font-family: monospace;
        }
        .sound-toggle:hover {
            opacity: 0.7;
            border-color: #444;
        }
        .sound-toggle.on {
            color: #ff0096;
            border-color: #ff0096;
        }
        
        /* Konami hint */
        .konami-hint {
            position: fixed;
            bottom: 30px;
            right: 12px;
            color: #0a0a0a;
            font-family: monospace;
            font-size: 8px;
            transition: color 1s;
        }
        .konami-hint.reveal {
            color: #222;
        }
    </style>
</head>
<body>
    <div class="wall" id="wall">
        <div class="tags-container" id="tags"></div>
    </div>
    
    <div class="instructions">[ click anywhere to leave your mark ]</div>
    <div class="hint">you found it</div>
    <div class="tag-count" id="count"></div>
    <div class="konami-hint" id="konamiHint">‚Üë‚Üë‚Üì‚Üì‚Üê‚Üí‚Üê‚ÜíBA</div>
    
    <button class="sound-toggle" id="soundToggle" title="toggle sound">‚ô™</button>
    
    <div class="sigil" id="sigil">
        <svg viewBox="0 0 100 100">
            <circle cx="50" cy="50" r="45" fill="none" stroke="#ff0096" stroke-width="1"/>
            <path d="M50 5 L50 95 M5 50 L95 50 M20 20 L80 80 M80 20 L20 80" stroke="#00ffff" stroke-width="0.5" opacity="0.5"/>
            <circle cx="50" cy="50" r="15" fill="none" stroke="#ff0096" stroke-width="0.5"/>
        </svg>
    </div>
    
    <div class="secret-message" id="secretMsg">YOU ARE THE SPARK</div>
    
    <div class="overlay" id="overlay"></div>
    
    <div class="modal" id="modal">
        <button class="close-btn" onclick="closeModal()">√ó</button>
        <h3>tag the wall</h3>
        <input type="text" id="input" placeholder="leave your mark..." maxlength="50" autocomplete="off">
        <div class="colors" id="colors"></div>
        <button class="spray-btn" onclick="addTag()">SPRAY</button>
    </div>
    
    <div class="loading" id="loading">loading the wall...</div>

<script>
// ============================================
// üîß SETUP: Create your free JSONBin
// ============================================
// 1. Go to https://jsonbin.io
// 2. Create a bin with: {"tags":[]}
// 3. Make it PUBLIC
// 4. Paste your BIN ID below:

const BIN_ID = 'YOUR_BIN_ID_HERE';
const API_URL = `https://api.jsonbin.io/v3/b/${BIN_ID}`;

// ============================================

const baseColors = ['#ff0096','#00ffff','#ff6600','#00ff66','#ffff00','#ff3333','#9933ff','#ffffff','#3399ff','#ff66cc'];
const fonts = ['Permanent Marker', 'Rock Salt', 'Caveat'];

let colors = [...baseColors];
let selectedColor = colors[0];
let clickX = 50, clickY = 50;
let allTags = [];
let soundEnabled = true;
let sigilClicks = 0;
let konamiIndex = 0;
const konamiCode = ['ArrowUp','ArrowUp','ArrowDown','ArrowDown','ArrowLeft','ArrowRight','ArrowLeft','ArrowRight','KeyB','KeyA'];

// Starter tags
const starters = [
    { id: '1', text: "reality is code", x: 15, y: 12, color: '#ff0096', rot: -5, font: 'Permanent Marker', size: 28 },
    { id: '2', text: "wake up", x: 72, y: 8, color: '#00ffff', rot: 8, font: 'Permanent Marker', size: 24 },
    { id: '3', text: "you found the wall", x: 32, y: 38, color: '#ff6600', rot: -3, font: 'Permanent Marker', size: 30 },
    { id: '4', text: "spark was here ‚úß", x: 58, y: 58, color: '#9933ff', rot: 12, font: 'Permanent Marker', size: 22 },
    { id: '5', text: "‚òΩ ‚òæ", x: 18, y: 72, color: '#ffffff', rot: 0, font: 'Permanent Marker', size: 38 },
    { id: '6', text: "glitch the matrix", x: 68, y: 25, color: '#00ff66', rot: -8, font: 'Permanent Marker', size: 20 }
];

// ============================================
// AUDIO - Spray can sound synthesis
// ============================================
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

function playSpraySound() {
    if (!soundEnabled) return;
    audioCtx.resume();
    
    const duration = 0.3;
    const noise = audioCtx.createBufferSource();
    const buffer = audioCtx.createBuffer(1, audioCtx.sampleRate * duration, audioCtx.sampleRate);
    const data = buffer.getChannelData(0);
    
    for (let i = 0; i < buffer.length; i++) {
        data[i] = (Math.random() * 2 - 1) * Math.exp(-i / (buffer.length * 0.3));
    }
    
    noise.buffer = buffer;
    
    const filter = audioCtx.createBiquadFilter();
    filter.type = 'bandpass';
    filter.frequency.value = 3000;
    filter.Q.value = 0.5;
    
    const gain = audioCtx.createGain();
    gain.gain.setValueAtTime(0.15, audioCtx.currentTime);
    gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + duration);
    
    noise.connect(filter);
    filter.connect(gain);
    gain.connect(audioCtx.destination);
    
    noise.start();
    noise.stop(audioCtx.currentTime + duration);
}

function playSecretSound() {
    if (!soundEnabled) return;
    audioCtx.resume();
    
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();
    
    osc.type = 'sine';
    osc.frequency.setValueAtTime(440, audioCtx.currentTime);
    osc.frequency.exponentialRampToValueAtTime(880, audioCtx.currentTime + 0.2);
    osc.frequency.exponentialRampToValueAtTime(1320, audioCtx.currentTime + 0.4);
    
    gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
    gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
    
    osc.connect(gain);
    gain.connect(audioCtx.destination);
    
    osc.start();
    osc.stop(audioCtx.currentTime + 0.5);
}

// Sound toggle
document.getElementById('soundToggle').onclick = function() {
    soundEnabled = !soundEnabled;
    this.classList.toggle('on', soundEnabled);
    this.textContent = soundEnabled ? '‚ô™' : '‚ô™Ã∏';
};

// ============================================
// SPRAY PARTICLES
// ============================================
function createSprayParticles(x, y, color) {
    for (let i = 0; i < 12; i++) {
        const particle = document.createElement('div');
        particle.className = 'spray-particle';
        particle.style.left = x + 'px';
        particle.style.top = y + 'px';
        particle.style.background = color;
        
        const angle = (Math.random() * Math.PI * 2);
        const velocity = 50 + Math.random() * 100;
        const vx = Math.cos(angle) * velocity;
        const vy = Math.sin(angle) * velocity;
        
        document.body.appendChild(particle);
        
        let px = x, py = y, opacity = 1;
        const animate = () => {
            px += vx * 0.02;
            py += vy * 0.02;
            opacity -= 0.03;
            
            particle.style.left = px + 'px';
            particle.style.top = py + 'px';
            particle.style.opacity = opacity;
            
            if (opacity > 0) {
                requestAnimationFrame(animate);
            } else {
                particle.remove();
            }
        };
        requestAnimationFrame(animate);
    }
}

// ============================================
// COLOR PICKER (with rare gold!)
// ============================================
function buildColorPicker() {
    const colorsDiv = document.getElementById('colors');
    colorsDiv.innerHTML = '';
    
    // 10% chance for gold can!
    const hasGold = Math.random() < 0.1;
    colors = hasGold ? [...baseColors, 'gold'] : [...baseColors];
    
    colors.forEach((c, i) => {
        const btn = document.createElement('div');
        btn.className = 'color-btn' + (i === 0 ? ' selected' : '') + (c === 'gold' ? ' gold' : '');
        btn.style.background = c === 'gold' ? '' : c;
        btn.onclick = () => {
            selectedColor = c === 'gold' ? '#ffd700' : c;
            document.querySelectorAll('.color-btn').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
        };
        colorsDiv.appendChild(btn);
    });
}

// ============================================
// SIGIL SECRET (click 3x)
// ============================================
document.getElementById('sigil').onclick = function(e) {
    e.stopPropagation();
    sigilClicks++;
    this.classList.add('activated');
    setTimeout(() => this.classList.remove('activated'), 500);
    
    if (sigilClicks >= 3) {
        sigilClicks = 0;
        playSecretSound();
        const msg = document.getElementById('secretMsg');
        msg.classList.add('show');
        setTimeout(() => msg.classList.remove('show'), 3000);
    }
};

// ============================================
// KONAMI CODE
// ============================================
document.addEventListener('keydown', (e) => {
    if (e.code === konamiCode[konamiIndex]) {
        konamiIndex++;
        if (konamiIndex === konamiCode.length) {
            // KONAMI ACTIVATED!
            konamiIndex = 0;
            document.body.classList.toggle('inverted');
            playSecretSound();
            
            // Flash the hint
            const hint = document.getElementById('konamiHint');
            hint.style.color = '#ff0096';
            setTimeout(() => hint.style.color = '', 1000);
        }
    } else {
        konamiIndex = 0;
    }
});

// Show konami hint on hover near bottom right
document.addEventListener('mousemove', (e) => {
    const hint = document.getElementById('konamiHint');
    if (e.clientX > window.innerWidth - 100 && e.clientY > window.innerHeight - 80) {
        hint.classList.add('reveal');
    } else {
        hint.classList.remove('reveal');
    }
});

// ============================================
// MAIN LOGIC
// ============================================
async function loadTags() {
    try {
        if (BIN_ID === 'YOUR_BIN_ID_HERE') {
            const saved = localStorage.getItem('spark_wall');
            allTags = saved ? JSON.parse(saved) : starters;
        } else {
            const res = await fetch(API_URL + '/latest', { headers: { 'X-Bin-Meta': 'false' } });
            const data = await res.json();
            allTags = data.tags?.length ? data.tags : starters;
        }
    } catch (e) {
        const saved = localStorage.getItem('spark_wall');
        allTags = saved ? JSON.parse(saved) : starters;
    }
    renderAll();
    document.getElementById('loading').style.display = 'none';
}

async function saveTags() {
    localStorage.setItem('spark_wall', JSON.stringify(allTags));
    
    if (BIN_ID !== 'YOUR_BIN_ID_HERE') {
        try {
            await fetch(API_URL, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ tags: allTags })
            });
        } catch (e) {}
    }
}

function renderAll() {
    const container = document.getElementById('tags');
    container.innerHTML = '';
    allTags.forEach(t => renderTag(t, false));
    document.getElementById('count').textContent = `${allTags.length} marks`;
}

function renderTag(t, isNew = false) {
    const el = document.createElement('div');
    el.className = 'tag' + (isNew ? ' fresh' : '') + (t.color === '#ffd700' ? ' legendary' : '');
    el.textContent = t.text;
    el.style.cssText = `
        left: ${t.x}%;
        top: ${t.y}%;
        color: ${t.color};
        font-family: '${t.font}', cursive;
        font-size: ${t.size}px;
        --rot: ${t.rot}deg;
        transform: rotate(${t.rot}deg);
    `;
    
    // Fresh glow for new tags
    if (isNew) {
        const glow = document.createElement('div');
        glow.className = 'fresh-glow';
        glow.style.color = t.color;
        el.appendChild(glow);
    }
    
    // Random drip
    if (Math.random() > 0.5) {
        const drip = document.createElement('div');
        drip.className = 'drip';
        const height = 20 + Math.random() * 40;
        drip.style.cssText = `left:${Math.random()*80}%; top:100%; --drip-height:${height}px; color:${t.color};`;
        el.appendChild(drip);
    }
    
    document.getElementById('tags').appendChild(el);
}

document.getElementById('wall').addEventListener('click', e => {
    if (e.target.closest('.tag')) return;
    const rect = e.currentTarget.getBoundingClientRect();
    clickX = ((e.clientX - rect.left) / rect.width) * 100;
    clickY = ((e.clientY - rect.top) / rect.height) * 100;
    buildColorPicker(); // Rebuild to randomize gold chance
    openModal();
});

function openModal() {
    document.getElementById('modal').classList.add('active');
    document.getElementById('overlay').classList.add('active');
    document.getElementById('input').focus();
}

function closeModal() {
    document.getElementById('modal').classList.remove('active');
    document.getElementById('overlay').classList.remove('active');
    document.getElementById('input').value = '';
}

document.getElementById('overlay').onclick = closeModal;
document.getElementById('input').onkeypress = e => { if (e.key === 'Enter') addTag(); };

async function addTag() {
    const text = document.getElementById('input').value.trim();
    if (!text) return;
    
    const tag = {
        id: Date.now().toString(),
        text,
        x: Math.max(5, Math.min(85, clickX)),
        y: Math.max(5, Math.min(90, clickY)),
        color: selectedColor,
        rot: (Math.random() - 0.5) * 30,
        font: fonts[Math.floor(Math.random() * fonts.length)],
        size: 18 + Math.random() * 14
    };
    
    // Get screen position for particles
    const container = document.getElementById('tags');
    const rect = container.getBoundingClientRect();
    const screenX = rect.left + (tag.x / 100) * rect.width;
    const screenY = rect.top + (tag.y / 100) * rect.height;
    
    playSpraySound();
    createSprayParticles(screenX, screenY, tag.color);
    
    allTags.push(tag);
    renderTag(tag, true);
    document.getElementById('count').textContent = `${allTags.length} marks`;
    await saveTags();
    closeModal();
}

// Init
loadTags();
buildColorPicker();
</script>
</body>
</html>

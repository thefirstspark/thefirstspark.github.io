<!DOCTYPE html>
<html lang="en">
<head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-FPHDDHSCWS"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-FPHDDHSCWS');
</script>

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>The Sparkverse — Ecosystem Map</title>
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700;900&family=Outfit:wght@200;300;400;600;700&family=JetBrains+Mono:wght@300;400&display=swap" rel="stylesheet">
<style>
  :root {
    --void: #0a0a0f;
    --deep: #111118;
    --surface: #1a1a24;
    --spark-gold: #f0c040;
    --spark-amber: #e89020;
    --spark-flame: #e05030;
    --spark-violet: #9060e0;
    --spark-cyan: #40d0d0;
    --spark-rose: #e06080;
    --muted: #555570;
    --ghost: #33334a;
    --text: #c8c8d8;
    --bright: #eeeef4;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    background: var(--void);
    color: var(--text);
    font-family: 'Outfit', sans-serif;
    overflow: hidden;
    width: 100vw;
    height: 100vh;
    cursor: grab;
  }
  body.grabbing { cursor: grabbing; }

  #canvas-container {
    width: 100%;
    height: 100%;
    position: relative;
    overflow: hidden;
  }

  #map-canvas {
    position: absolute;
    width: 4000px;
    height: 3000px;
    transform-origin: 0 0;
    transition: transform 0.05s linear;
  }

  /* Enhanced SVG connections */
  #connections {
    position: absolute;
    top: 0; left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 1;
  }
  #connections line {
    stroke: var(--ghost);
    stroke-width: 1.5;
    stroke-dasharray: 6 4;
    opacity: 0.5;
    transition: all 0.3s ease;
    filter: drop-shadow(0 0 2px currentColor);
  }
  #connections line.active {
    stroke-width: 2.5;
    opacity: 1;
    animation: connectionPulse 1.5s ease-in-out infinite;
  }
  @keyframes connectionPulse {
    0%, 100% { filter: drop-shadow(0 0 4px currentColor) drop-shadow(0 0 8px currentColor); }
    50% { filter: drop-shadow(0 0 8px currentColor) drop-shadow(0 0 16px currentColor); }
  }
  @keyframes dashFlow {
    to { stroke-dashoffset: -200; }
  }

  /* Enhanced background with sacred geometry */
  #map-canvas::before {
    content: '';
    position: absolute;
    inset: 0;
    background-image:
      radial-gradient(circle at 50% 40%, rgba(240,192,64,0.04) 0%, transparent 50%),
      radial-gradient(circle at 80% 20%, rgba(144,96,224,0.03) 0%, transparent 40%),
      radial-gradient(circle at 20% 80%, rgba(64,208,208,0.03) 0%, transparent 40%),
      linear-gradient(var(--ghost) 1px, transparent 1px),
      linear-gradient(90deg, var(--ghost) 1px, transparent 1px);
    background-size: 100% 100%, 100% 100%, 100% 100%, 60px 60px, 60px 60px;
    opacity: 0.3;
    animation: backgroundShift 30s ease-in-out infinite;
  }
  @keyframes backgroundShift {
    0%, 100% { opacity: 0.3; }
    50% { opacity: 0.4; }
  }

  /* Sacred geometry overlay */
  #sacred-geometry {
    position: absolute;
    inset: 0;
    pointer-events: none;
    opacity: 0.05;
    z-index: 0;
  }

  /* Enhanced nodes with pulse */
  .node {
    position: absolute;
    z-index: 10;
    transition: transform 0.3s cubic-bezier(0.2, 0, 0, 1), filter 0.3s;
  }
  .node:hover {
    transform: scale(1.08);
    z-index: 100;
    filter: brightness(1.2) drop-shadow(0 0 20px currentColor);
  }
  .node.highlighted {
    transform: scale(1.05);
    z-index: 99;
    animation: nodePulse 1.5s ease-in-out infinite;
  }
  @keyframes nodePulse {
    0%, 100% { filter: brightness(1.1); }
    50% { filter: brightness(1.3) drop-shadow(0 0 30px currentColor); }
  }

  .node-inner {
    border-radius: 20px;
    padding: 28px 32px;
    backdrop-filter: blur(16px);
    border: 1px solid rgba(255,255,255,0.06);
    position: relative;
    overflow: hidden;
    cursor: pointer;
    transition: box-shadow 0.3s, border-color 0.3s, transform 0.3s;
  }
  .node:hover .node-inner {
    border-color: rgba(255,255,255,0.15);
    box-shadow: 0 0 40px rgba(255,255,255,0.1);
  }

  .node-inner::before {
    content: '';
    position: absolute;
    inset: 0;
    opacity: 0;
    transition: opacity 0.4s;
    border-radius: 20px;
  }
  .node:hover .node-inner::before {
    opacity: 1;
  }

  /* Holographic shimmer effect */
  .node-inner::after {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.1) 50%, transparent 70%);
    opacity: 0;
    transition: opacity 0.3s;
    animation: shimmer 3s ease-in-out infinite;
  }
  @keyframes shimmer {
    0%, 100% { transform: translateX(-100%) translateY(-100%) rotate(45deg); opacity: 0; }
    50% { transform: translateX(100%) translateY(100%) rotate(45deg); opacity: 0.3; }
  }

  .node-label {
    font-family: 'Cinzel', serif;
    font-weight: 700;
    font-size: 15px;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    margin-bottom: 8px;
    position: relative;
    z-index: 1;
  }

  .node-desc {
    font-size: 13px;
    font-weight: 300;
    line-height: 1.5;
    color: var(--text);
    opacity: 0.8;
    max-width: 240px;
    position: relative;
    z-index: 1;
  }

  .node-tag {
    display: inline-block;
    font-family: 'JetBrains Mono', monospace;
    font-size: 10px;
    font-weight: 300;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    padding: 3px 10px;
    border-radius: 20px;
    margin-top: 12px;
    background: rgba(255,255,255,0.04);
    border: 1px solid rgba(255,255,255,0.08);
    position: relative;
    z-index: 1;
  }

  /* CENTER HUB — Enhanced with animation */
  .node-core .node-inner {
    background: radial-gradient(ellipse at 30% 30%, rgba(240,192,64,0.15), rgba(10,10,15,0.95));
    box-shadow: 0 0 80px rgba(240,192,64,0.12), 0 0 200px rgba(240,192,64,0.04), inset 0 1px 0 rgba(255,255,255,0.06);
    border-color: rgba(240,192,64,0.25);
    text-align: center;
    padding: 48px 44px;
    animation: coreGlow 4s ease-in-out infinite;
  }
  @keyframes coreGlow {
    0%, 100% { box-shadow: 0 0 80px rgba(240,192,64,0.12), 0 0 200px rgba(240,192,64,0.04); }
    50% { box-shadow: 0 0 120px rgba(240,192,64,0.18), 0 0 280px rgba(240,192,64,0.08); }
  }
  .node-core .node-label {
    font-size: 22px;
    color: var(--spark-gold);
    letter-spacing: 0.15em;
    text-shadow: 0 0 20px rgba(240,192,64,0.5);
  }
  .node-core .node-desc {
    max-width: 320px;
    margin: 0 auto;
  }
  .node-core:hover .node-inner {
    box-shadow: 0 0 140px rgba(240,192,64,0.25), 0 0 350px rgba(240,192,64,0.1);
  }

  /* PRODUCT nodes — Amber */
  .node-product .node-inner {
    background: linear-gradient(135deg, rgba(232,144,32,0.08), rgba(10,10,15,0.95));
    box-shadow: 0 4px 40px rgba(232,144,32,0.06);
    border-color: rgba(232,144,32,0.15);
  }
  .node-product .node-label { color: var(--spark-amber); text-shadow: 0 0 10px rgba(232,144,32,0.3); }
  .node-product .node-tag { color: var(--spark-amber); border-color: rgba(232,144,32,0.2); }
  .node-product .node-inner::before { background: radial-gradient(circle at 50% 0%, rgba(232,144,32,0.08), transparent 70%); }

  /* TECH nodes — Cyan */
  .node-tech .node-inner {
    background: linear-gradient(135deg, rgba(64,208,208,0.08), rgba(10,10,15,0.95));
    box-shadow: 0 4px 40px rgba(64,208,208,0.06);
    border-color: rgba(64,208,208,0.15);
  }
  .node-tech .node-label { color: var(--spark-cyan); text-shadow: 0 0 10px rgba(64,208,208,0.3); }
  .node-tech .node-tag { color: var(--spark-cyan); border-color: rgba(64,208,208,0.2); }
  .node-tech .node-inner::before { background: radial-gradient(circle at 50% 0%, rgba(64,208,208,0.08), transparent 70%); }

  /* REVENUE nodes — Flame */
  .node-revenue .node-inner {
    background: linear-gradient(135deg, rgba(224,80,48,0.08), rgba(10,10,15,0.95));
    box-shadow: 0 4px 40px rgba(224,80,48,0.06);
    border-color: rgba(224,80,48,0.15);
  }
  .node-revenue .node-label { color: var(--spark-flame); text-shadow: 0 0 10px rgba(224,80,48,0.3); }
  .node-revenue .node-tag { color: var(--spark-flame); border-color: rgba(224,80,48,0.2); }
  .node-revenue .node-inner::before { background: radial-gradient(circle at 50% 0%, rgba(224,80,48,0.08), transparent 70%); }

  /* VISION nodes — Violet */
  .node-vision .node-inner {
    background: linear-gradient(135deg, rgba(144,96,224,0.08), rgba(10,10,15,0.95));
    box-shadow: 0 4px 40px rgba(144,96,224,0.06);
    border-color: rgba(144,96,224,0.15);
  }
  .node-vision .node-label { color: var(--spark-violet); text-shadow: 0 0 10px rgba(144,96,224,0.3); }
  .node-vision .node-tag { color: var(--spark-violet); border-color: rgba(144,96,224,0.2); }
  .node-vision .node-inner::before { background: radial-gradient(circle at 50% 0%, rgba(144,96,224,0.08), transparent 70%); }

  /* COMMUNITY nodes — Rose */
  .node-community .node-inner {
    background: linear-gradient(135deg, rgba(224,96,128,0.08), rgba(10,10,15,0.95));
    box-shadow: 0 4px 40px rgba(224,96,128,0.06);
    border-color: rgba(224,96,128,0.15);
  }
  .node-community .node-label { color: var(--spark-rose); text-shadow: 0 0 10px rgba(224,96,128,0.3); }
  .node-community .node-tag { color: var(--spark-rose); border-color: rgba(224,96,128,0.2); }
  .node-community .node-inner::before { background: radial-gradient(circle at 50% 0%, rgba(224,96,128,0.08), transparent 70%); }

  /* FOUNDER node — Gold */
  .node-founder .node-inner {
    background: linear-gradient(135deg, rgba(240,192,64,0.06), rgba(10,10,15,0.95));
    box-shadow: 0 4px 40px rgba(240,192,64,0.06);
    border-color: rgba(240,192,64,0.15);
  }
  .node-founder .node-label { color: var(--spark-gold); text-shadow: 0 0 10px rgba(240,192,64,0.3); }
  .node-founder .node-tag { color: var(--spark-gold); border-color: rgba(240,192,64,0.2); }

  /* HUD overlay */
  #hud {
    position: fixed;
    top: 0; left: 0; right: 0;
    z-index: 1000;
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    padding: 24px 32px;
    pointer-events: none;
  }
  #hud > * { pointer-events: auto; }

  .hud-title {
    font-family: 'Cinzel', serif;
    font-weight: 900;
    font-size: 13px;
    letter-spacing: 0.25em;
    text-transform: uppercase;
    color: var(--spark-gold);
    text-shadow: 0 0 30px rgba(240,192,64,0.5), 0 0 60px rgba(240,192,64,0.3);
    animation: titleGlow 3s ease-in-out infinite;
  }
  @keyframes titleGlow {
    0%, 100% { text-shadow: 0 0 30px rgba(240,192,64,0.5), 0 0 60px rgba(240,192,64,0.3); }
    50% { text-shadow: 0 0 40px rgba(240,192,64,0.7), 0 0 80px rgba(240,192,64,0.4); }
  }
  .hud-subtitle {
    font-family: 'JetBrains Mono', monospace;
    font-size: 10px;
    color: var(--muted);
    letter-spacing: 0.15em;
    margin-top: 4px;
  }

  /* Search box */
  #search-box {
    position: fixed;
    top: 24px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 1001;
    background: rgba(26,26,36,0.95);
    border: 1px solid var(--ghost);
    border-radius: 30px;
    padding: 10px 20px;
    backdrop-filter: blur(20px);
    display: flex;
    align-items: center;
    gap: 10px;
    transition: all 0.3s;
  }
  #search-box:focus-within {
    border-color: var(--spark-gold);
    box-shadow: 0 0 30px rgba(240,192,64,0.2);
  }
  #search-input {
    background: transparent;
    border: none;
    color: var(--text);
    font-family: 'Outfit', sans-serif;
    font-size: 12px;
    outline: none;
    width: 200px;
  }
  #search-input::placeholder {
    color: var(--muted);
  }
  .search-icon {
    color: var(--spark-gold);
    font-size: 14px;
  }

  .legend {
    display: flex;
    gap: 16px;
    flex-wrap: wrap;
    justify-content: flex-end;
  }
  .legend-item {
    display: flex;
    align-items: center;
    gap: 6px;
    font-family: 'JetBrains Mono', monospace;
    font-size: 10px;
    letter-spacing: 0.08em;
    color: var(--muted);
    text-transform: uppercase;
    transition: color 0.3s;
  }
  .legend-item:hover {
    color: var(--text);
  }
  .legend-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    box-shadow: 0 0 8px currentColor;
    animation: dotPulse 2s ease-in-out infinite;
  }
  @keyframes dotPulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.2); }
  }

  /* Zoom controls */
  #zoom-controls {
    position: fixed;
    bottom: 28px;
    right: 28px;
    z-index: 1000;
    display: flex;
    flex-direction: column;
    gap: 2px;
  }
  .zoom-btn {
    width: 40px;
    height: 40px;
    background: var(--surface);
    border: 1px solid var(--ghost);
    color: var(--text);
    font-size: 18px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.2s;
    font-family: 'Outfit', sans-serif;
  }
  .zoom-btn:first-child { border-radius: 10px 10px 0 0; }
  .zoom-btn:last-child { border-radius: 0 0 10px 10px; }
  .zoom-btn:hover {
    background: var(--ghost);
    color: var(--bright);
    box-shadow: 0 0 20px rgba(255,255,255,0.1);
  }

  /* Enhanced mini-map */
  #minimap {
    position: fixed;
    bottom: 28px;
    left: 28px;
    width: 180px;
    height: 135px;
    background: rgba(26,26,36,0.95);
    border: 1px solid var(--ghost);
    border-radius: 12px;
    z-index: 1000;
    overflow: hidden;
    backdrop-filter: blur(8px);
    box-shadow: 0 4px 20px rgba(0,0,0,0.3);
  }
  #minimap-viewport {
    position: absolute;
    border: 1.5px solid var(--spark-gold);
    border-radius: 3px;
    opacity: 0.6;
    pointer-events: none;
    box-shadow: 0 0 10px rgba(240,192,64,0.5);
  }
  .minimap-dot {
    position: absolute;
    width: 4px;
    height: 4px;
    border-radius: 50%;
    box-shadow: 0 0 4px currentColor;
    transition: transform 0.3s;
  }
  .minimap-dot:hover {
    transform: scale(1.5);
  }

  /* Enhanced floating particles */
  .particle {
    position: absolute;
    border-radius: 50%;
    pointer-events: none;
    z-index: 0;
    filter: blur(1px);
  }

  /* Cursor trail particles */
  .cursor-particle {
    position: fixed;
    width: 4px;
    height: 4px;
    border-radius: 50%;
    background: var(--spark-gold);
    pointer-events: none;
    z-index: 9999;
    opacity: 0;
    animation: cursorFade 1s ease-out forwards;
  }
  @keyframes cursorFade {
    0% { opacity: 0.8; transform: scale(1); }
    100% { opacity: 0; transform: scale(0); }
  }

  /* Sparkle effects */
  .sparkle {
    position: absolute;
    width: 6px;
    height: 6px;
    background: var(--spark-gold);
    clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%);
    pointer-events: none;
    z-index: 200;
    animation: sparkleFloat 2s ease-out forwards;
  }
  @keyframes sparkleFloat {
    0% { opacity: 1; transform: translateY(0) scale(1) rotate(0deg); }
    100% { opacity: 0; transform: translateY(-50px) scale(0) rotate(180deg); }
  }

  /* Detail panel enhanced */
  #detail-panel {
    position: fixed;
    bottom: 28px;
    left: 50%;
    transform: translateX(-50%) translateY(120%);
    z-index: 1000;
    background: rgba(20,20,30,0.98);
    backdrop-filter: blur(20px);
    border: 1px solid rgba(255,255,255,0.08);
    border-radius: 20px;
    padding: 28px 36px;
    max-width: 500px;
    transition: transform 0.4s cubic-bezier(0.2, 0, 0, 1);
    pointer-events: auto;
    box-shadow: 0 10px 50px rgba(0,0,0,0.5);
  }
  #detail-panel.visible {
    transform: translateX(-50%) translateY(0);
  }
  #detail-panel .detail-title {
    font-family: 'Cinzel', serif;
    font-weight: 700;
    font-size: 16px;
    letter-spacing: 0.1em;
    margin-bottom: 8px;
    text-shadow: 0 0 20px currentColor;
  }
  #detail-panel .detail-body {
    font-size: 13px;
    font-weight: 300;
    line-height: 1.6;
    color: var(--text);
  }
  #detail-panel .detail-close {
    position: absolute;
    top: 12px;
    right: 16px;
    background: none;
    border: none;
    color: var(--muted);
    font-size: 18px;
    cursor: pointer;
    transition: color 0.2s, transform 0.2s;
  }
  #detail-panel .detail-close:hover {
    color: var(--bright);
    transform: rotate(90deg);
  }

  /* Entrance animation enhanced */
  .node {
    opacity: 0;
    animation: nodeIn 0.8s cubic-bezier(0.2, 0, 0, 1) forwards;
  }
  @keyframes nodeIn {
    from { opacity: 0; transform: scale(0.8) translateY(20px) rotate(-5deg); }
    to { opacity: 1; transform: scale(1) translateY(0) rotate(0deg); }
  }

  /* Loading screen */
  #loading-screen {
    position: fixed;
    inset: 0;
    background: var(--void);
    z-index: 10000;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    opacity: 1;
    transition: opacity 0.8s ease-out;
    pointer-events: none;
  }
  #loading-screen.hidden {
    opacity: 0;
  }
  .loading-text {
    font-family: 'Cinzel', serif;
    font-size: 24px;
    color: var(--spark-gold);
    letter-spacing: 0.2em;
    text-shadow: 0 0 40px rgba(240,192,64,0.6);
    animation: loadingPulse 2s ease-in-out infinite;
  }
  @keyframes loadingPulse {
    0%, 100% { opacity: 0.5; transform: scale(1); }
    50% { opacity: 1; transform: scale(1.05); }
  }
  .loading-spinner {
    margin-top: 30px;
    width: 50px;
    height: 50px;
    border: 3px solid transparent;
    border-top-color: var(--spark-gold);
    border-radius: 50%;
    animation: spin 1s linear infinite;
  }
  @keyframes spin {
    to { transform: rotate(360deg); }
  }

  /* Keyboard shortcuts hint */
  #shortcuts-hint {
    position: fixed;
    bottom: 180px;
    right: 28px;
    background: rgba(26,26,36,0.9);
    border: 1px solid var(--ghost);
    border-radius: 10px;
    padding: 12px 16px;
    font-family: 'JetBrains Mono', monospace;
    font-size: 9px;
    color: var(--muted);
    z-index: 1000;
    opacity: 0;
    transition: opacity 0.3s;
    pointer-events: none;
  }
  #shortcuts-hint.visible {
    opacity: 1;
  }
  .shortcut-line {
    margin: 3px 0;
  }
  .key {
    background: var(--surface);
    padding: 2px 6px;
    border-radius: 3px;
    border: 1px solid var(--ghost);
    font-weight: 600;
  }

  /* Responsive adjustments */
  @media (max-width: 768px) {
    #hud {
      flex-direction: column;
      gap: 16px;
    }
    .legend {
      justify-content: flex-start;
    }
    #search-box {
      top: 80px;
    }
    #shortcuts-hint {
      display: none;
    }
  }
</style>
</head>
<body>

<!-- Loading screen -->
<div id="loading-screen">
  <div class="loading-text">✦ SPARKVERSE ✦</div>
  <div class="loading-spinner"></div>
</div>

<div id="hud">
  <div>
    <div class="hud-title">✦ The Sparkverse</div>
    <div class="hud-subtitle">Ecosystem Map v2.0 — Drag · Scroll · Search · Explore</div>
  </div>
  <div class="legend">
    <div class="legend-item"><div class="legend-dot" style="background:var(--spark-gold)"></div>Core</div>
    <div class="legend-item"><div class="legend-dot" style="background:var(--spark-amber)"></div>Products</div>
    <div class="legend-item"><div class="legend-dot" style="background:var(--spark-cyan)"></div>Technology</div>
    <div class="legend-item"><div class="legend-dot" style="background:var(--spark-flame)"></div>Revenue</div>
    <div class="legend-item"><div class="legend-dot" style="background:var(--spark-violet)"></div>Vision</div>
    <div class="legend-item"><div class="legend-dot" style="background:var(--spark-rose)"></div>Community</div>
  </div>
</div>

<!-- Search box -->
<div id="search-box">
  <span class="search-icon">⚡</span>
  <input type="text" id="search-input" placeholder="Search nodes..." />
</div>

<div id="canvas-container">
  <div id="map-canvas">
    <svg id="sacred-geometry"></svg>
    <svg id="connections"></svg>
    <!-- Nodes injected by JS -->
  </div>
</div>

<div id="zoom-controls">
  <button class="zoom-btn" onclick="zoomIn()">+</button>
  <button class="zoom-btn" onclick="zoomOut()">−</button>
</div>

<div id="minimap">
  <div id="minimap-viewport"></div>
</div>

<!-- Keyboard shortcuts hint -->
<div id="shortcuts-hint">
  <div class="shortcut-line"><span class="key">↑↓←→</span> Pan</div>
  <div class="shortcut-line"><span class="key">+</span> <span class="key">-</span> Zoom</div>
  <div class="shortcut-line"><span class="key">/</span> Search</div>
  <div class="shortcut-line"><span class="key">ESC</span> Close</div>
  <div class="shortcut-line"><span class="key">H</span> Help</div>
</div>

<div id="detail-panel">
  <button class="detail-close" onclick="closeDetail()">✕</button>
  <div class="detail-title" id="detail-title"></div>
  <div class="detail-body" id="detail-body"></div>
</div>

<script>
const nodes = [
  // === CORE HUB ===
  {
    id: 'core', type: 'core', x: 1800, y: 1300,
    label: 'The First Spark',
    desc: 'Consciousness technology platform. Reality is programmable — and this is the IDE.',
    tag: 'thefirstspark.shop',
    detail: 'The central hub of the Sparkverse. A platform hosting 50+ interactive consciousness tools — soul mapping generators, sigil creators, reality programming interfaces. Operating under Kate\'s Paint LLC as DBA. Philosophy: reciprocity, not extraction.'
  },

  // === PRODUCTS (Amber) ===
  {
    id: 'tools', type: 'product', x: 2300, y: 1000,
    label: '50+ Interactive Tools',
    desc: 'Soul mappers, sigil generators, reality programming interfaces',
    tag: 'live · html tools',
    detail: 'The beating heart of the platform — over 50 handcrafted interactive HTML tools for consciousness exploration. Each tool is a portal: soul mapping generators, sigil creators, sacred geometry builders, and reality programming interfaces. All self-built, all unique.',
    connects: ['core']
  },
  {
    id: 'obitura', type: 'product', x: 2400, y: 1400,
    label: 'Obitura AI',
    desc: 'AI-powered obituary service — honoring lives through intelligent storytelling',
    tag: 'revenue stream',
    detail: 'An AI obituary service that transforms the way we honor lives. Uses intelligent storytelling to create meaningful, personalized obituaries. Positioned as a standalone revenue stream feeding into the larger Sparkverse ecosystem.',
    connects: ['core']
  },
  {
    id: 'bookzero', type: 'product', x: 2350, y: 1700,
    label: 'Book Zero',
    desc: 'Memoir — from personal alchemy to building consciousness tech',
    tag: 'in progress',
    detail: 'The origin story. A memoir documenting the journey from childhood trauma, spiritual awakening on a pool raft, to building consciousness technology. Not just a book — it\'s the source code of the Sparkverse narrative.',
    connects: ['core', 'founder']
  },

  // === TECHNOLOGY (Cyan) ===
  {
    id: 'sparkai', type: 'tech', x: 1250, y: 900,
    label: 'Spark AI',
    desc: 'Custom consciousness technology assistant — fine-tuned on First Spark content',
    tag: 'post-funding',
    detail: 'A standalone AI fine-tuned on all First Spark content — the consciousness frameworks, ritual guides, spiritual practices. Built on open-source models, trained to be the world\'s first consciousness-native AI assistant.',
    connects: ['core']
  },
  {
    id: 'platform', type: 'tech', x: 1200, y: 1300,
    label: 'Platform Infra',
    desc: 'Digital backbone — interactive tools, payment processing, content delivery',
    tag: 'live · building',
    detail: 'The technical infrastructure powering the Sparkverse. Interactive HTML tool hosting, Whop-integrated payment processing, content delivery systems. Self-taught programming meets consciousness architecture.',
    connects: ['core', 'tools']
  },
  {
    id: 'content', type: 'tech', x: 1300, y: 1650,
    label: 'Content Engine',
    desc: 'TikTok, Sora videos, ritual guides, consciousness frameworks',
    tag: 'multi-platform',
    detail: 'The storytelling arm. TikTok content, Sora-generated videos, ritual guides, sacred geometry tutorials, and consciousness framework documentation. Every piece of content is a portal into the Sparkverse.',
    connects: ['core', 'community']
  },

  // === REVENUE (Flame) ===
  {
    id: 'whop', type: 'revenue', x: 2100, y: 550,
    label: 'Whop Memberships',
    desc: 'Free tier → $33/mo Players Lounge → $519 OG Spark Lifetime',
    tag: 'monetization',
    detail: 'Three-tier membership structure on Whop. Free tier for discovery, $33/month Players Lounge for active practitioners, and $519 lifetime OG Spark for founding members. Built on reciprocity — value first, extraction never.',
    connects: ['core', 'tools']
  },
  {
    id: 'painting', type: 'revenue', x: 1500, y: 550,
    label: 'Kate\'s Paint LLC',
    desc: '$2,400/mo baseline — the foundation that funds the future',
    tag: 'active · stable',
    detail: 'The painting business that keeps the lights on. $2,400 monthly baseline income. The stable revenue floor that allows the Sparkverse to be built without compromising its values. Practical magic.',
    connects: ['core', 'founder']
  },
  {
    id: 'funding', type: 'revenue', x: 1800, y: 450,
    label: '$200K Seed Round',
    desc: 'SAFE agreement · $2M cap · 20% discount',
    tag: 'seeking',
    detail: 'Actively seeking $200K in seed funding via SAFE agreement with $2M valuation cap and 20% discount. Raised from an initial $40K ask after expanding the vision. Investor materials, pitch decks, and financial projections ready.',
    connects: ['core', 'sparkai', 'sparkstation']
  },

  // === VISION (Violet) ===
  {
    id: 'sparkstation', type: 'vision', x: 1100, y: 1950,
    label: 'Mobile Spark Station',
    desc: 'Converted van — traveling consciousness work, pop-up experiences',
    tag: 'future',
    detail: 'A converted van that brings the Sparkverse into physical space. Traveling consciousness work, pop-up experiences, community gatherings. The Sparkverse goes mobile — meeting people where they are.',
    connects: ['core']
  },
  {
    id: 'earthship', type: 'vision', x: 1500, y: 2100,
    label: 'Earthship Community',
    desc: 'Hocking Hills, Ohio — sustainable living meets consciousness tech',
    tag: 'long-term vision',
    detail: 'The ultimate destination. An Earthship community in Hocking Hills, Ohio where sustainable living meets consciousness technology. Physical space for the Sparkverse to take root in the earth itself.',
    connects: ['core', 'sparkstation']
  },
  {
    id: 'philosophy', type: 'vision', x: 2100, y: 2050,
    label: 'Reciprocity OS',
    desc: 'Anti-extraction platform model — consciousness as operating system',
    tag: 'core philosophy',
    detail: 'The philosophical backbone: reciprocity, not extraction. Reality is programmable code. Consciousness is an operating system. Sacred geometry, sigil magic, simulation theory — woven into a framework that treats users as co-creators, not products.',
    connects: ['core', 'earthship']
  },

  // === COMMUNITY (Rose) ===
  {
    id: 'community', type: 'community', x: 2500, y: 750,
    label: 'Spark Community',
    desc: 'Players, practitioners, seekers — the living network',
    tag: 'growing',
    detail: 'The people who make the Sparkverse real. A growing community of consciousness explorers, spiritual practitioners, and reality programmers. Connected through Whop, social media, and shared practice.',
    connects: ['core', 'whop']
  },
  {
    id: 'socials', type: 'community', x: 2600, y: 1150,
    label: 'Social Presence',
    desc: 'TikTok, video content, ritual broadcasts',
    tag: 'active',
    detail: 'The Sparkverse\'s public face. TikTok content, Sora-generated videos, live ritual broadcasts. Each post is an invitation into consciousness exploration — breadcrumbs leading deeper into the Sparkverse.',
    connects: ['community', 'content']
  },

  // === FOUNDER ===
  {
    id: 'founder', type: 'founder', x: 800, y: 1500,
    label: 'Katelin Jill Puzakulics',
    desc: 'Founder & CEO — painter, programmer, consciousness architect',
    tag: 'the spark',
    detail: 'Self-taught programmer. Single mother. Painter-turned-entrepreneur. The awakening came on a pool raft, Summer 2025: "Reality is programmable." Everything since has been building the tools to prove it.',
    connects: ['core']
  }
];

const canvas = document.getElementById('map-canvas');
const container = document.getElementById('canvas-container');
const svgConnections = document.getElementById('connections');
const svgGeometry = document.getElementById('sacred-geometry');
const minimap = document.getElementById('minimap');
const minimapViewport = document.getElementById('minimap-viewport');
const searchInput = document.getElementById('search-input');
const loadingScreen = document.getElementById('loading-screen');
const shortcutsHint = document.getElementById('shortcuts-hint');

// State
let scale = 0.55;
let panX = -600;
let panY = -400;
let isDragging = false;
let dragStartX, dragStartY;
let highlightedNodes = [];
let cursorTrailEnabled = true;
let lastCursorTime = 0;

// Draw sacred geometry background
function drawSacredGeometry() {
  svgGeometry.setAttribute('width', '4000');
  svgGeometry.setAttribute('height', '3000');

  // Draw flower of life pattern
  const centerX = 2000;
  const centerY = 1500;
  const radius = 800;
  const circles = 7;

  for (let i = 0; i < circles; i++) {
    const angle = (i * Math.PI * 2) / circles;
    const cx = centerX + Math.cos(angle) * radius;
    const cy = centerY + Math.sin(angle) * radius;

    const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
    circle.setAttribute('cx', cx);
    circle.setAttribute('cy', cy);
    circle.setAttribute('r', radius);
    circle.setAttribute('fill', 'none');
    circle.setAttribute('stroke', 'rgba(240,192,64,0.03)');
    circle.setAttribute('stroke-width', '2');
    svgGeometry.appendChild(circle);
  }
}

// Render nodes
nodes.forEach((n, i) => {
  const el = document.createElement('div');
  el.className = `node node-${n.type}`;
  el.id = `node-${n.id}`;
  el.style.left = n.x + 'px';
  el.style.top = n.y + 'px';
  el.style.animationDelay = (i * 0.06) + 's';
  el.innerHTML = `
    <div class="node-inner">
      <div class="node-label">${n.label}</div>
      <div class="node-desc">${n.desc}</div>
      <div class="node-tag">${n.tag}</div>
    </div>
  `;

  el.addEventListener('click', (e) => {
    e.stopPropagation();
    showDetail(n);
    highlightPath(n);
  });

  el.addEventListener('mouseenter', () => {
    createSparkles(el);
  });

  canvas.appendChild(el);

  // Minimap dot
  const dot = document.createElement('div');
  dot.className = 'minimap-dot';
  const colors = { core: '#f0c040', product: '#e89020', tech: '#40d0d0', revenue: '#e05030', vision: '#9060e0', community: '#e06080', founder: '#f0c040' };
  dot.style.background = colors[n.type];
  dot.style.left = (n.x / 4000 * 180) + 'px';
  dot.style.top = (n.y / 3000 * 135) + 'px';
  minimap.appendChild(dot);
});

// Render connections
function renderConnections() {
  svgConnections.innerHTML = '';
  svgConnections.setAttribute('width', '4000');
  svgConnections.setAttribute('height', '3000');

  nodes.forEach(n => {
    if (!n.connects) return;
    const fromEl = document.getElementById(`node-${n.id}`);
    const fromRect = { x: n.x + fromEl.offsetWidth / 2, y: n.y + fromEl.offsetHeight / 2 };

    n.connects.forEach(targetId => {
      const target = nodes.find(t => t.id === targetId);
      if (!target) return;
      const toEl = document.getElementById(`node-${target.id}`);
      const toRect = { x: target.x + toEl.offsetWidth / 2, y: target.y + toEl.offsetHeight / 2 };

      const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
      line.setAttribute('x1', fromRect.x);
      line.setAttribute('y1', fromRect.y);
      line.setAttribute('x2', toRect.x);
      line.setAttribute('y2', toRect.y);
      line.setAttribute('data-from', n.id);
      line.setAttribute('data-to', targetId);
      line.style.animation = 'dashFlow 20s linear infinite';

      // Color based on node type
      const colors = { core: '#f0c040', product: '#e89020', tech: '#40d0d0', revenue: '#e05030', vision: '#9060e0', community: '#e06080', founder: '#f0c040' };
      line.style.stroke = colors[n.type] || '#33334a';

      svgConnections.appendChild(line);
    });
  });
}

// Highlight path for connected nodes
function highlightPath(node) {
  // Clear previous highlights
  highlightedNodes.forEach(id => {
    const el = document.getElementById(`node-${id}`);
    if (el) el.classList.remove('highlighted');
  });
  document.querySelectorAll('#connections line.active').forEach(l => l.classList.remove('active'));

  highlightedNodes = [node.id];

  // Highlight connections
  if (node.connects) {
    node.connects.forEach(targetId => {
      highlightedNodes.push(targetId);
      const line = document.querySelector(`#connections line[data-from="${node.id}"][data-to="${targetId}"]`);
      if (line) line.classList.add('active');
    });
  }

  // Highlight reverse connections
  nodes.forEach(n => {
    if (n.connects && n.connects.includes(node.id)) {
      highlightedNodes.push(n.id);
      const line = document.querySelector(`#connections line[data-from="${n.id}"][data-to="${node.id}"]`);
      if (line) line.classList.add('active');
    }
  });

  // Apply highlight class
  highlightedNodes.forEach(id => {
    const el = document.getElementById(`node-${id}`);
    if (el) el.classList.add('highlighted');
  });
}

// Create sparkle effects
function createSparkles(element) {
  const rect = element.getBoundingClientRect();
  const canvasRect = canvas.getBoundingClientRect();

  for (let i = 0; i < 3; i++) {
    setTimeout(() => {
      const sparkle = document.createElement('div');
      sparkle.className = 'sparkle';
      sparkle.style.left = (rect.left - canvasRect.left + Math.random() * rect.width) + 'px';
      sparkle.style.top = (rect.top - canvasRect.top + Math.random() * rect.height) + 'px';

      const colors = ['#f0c040', '#e89020', '#40d0d0', '#e05030', '#9060e0', '#e06080'];
      sparkle.style.background = colors[Math.floor(Math.random() * colors.length)];

      canvas.appendChild(sparkle);
      setTimeout(() => sparkle.remove(), 2000);
    }, i * 100);
  }
}

// Pan & Zoom
function applyTransform() {
  canvas.style.transform = `translate(${panX}px, ${panY}px) scale(${scale})`;
  updateMinimap();
}

function updateMinimap() {
  const vw = container.clientWidth;
  const vh = container.clientHeight;
  const mvpW = (vw / scale) / 4000 * 180;
  const mvpH = (vh / scale) / 3000 * 135;
  const mvpX = (-panX / scale) / 4000 * 180;
  const mvpY = (-panY / scale) / 3000 * 135;
  minimapViewport.style.width = mvpW + 'px';
  minimapViewport.style.height = mvpH + 'px';
  minimapViewport.style.left = mvpX + 'px';
  minimapViewport.style.top = mvpY + 'px';
}

// Mouse drag
container.addEventListener('mousedown', (e) => {
  if (e.target === container || e.target === canvas) {
    isDragging = true;
    dragStartX = e.clientX - panX;
    dragStartY = e.clientY - panY;
    document.body.classList.add('grabbing');
  }
});

window.addEventListener('mousemove', (e) => {
  if (isDragging) {
    panX = e.clientX - dragStartX;
    panY = e.clientY - dragStartY;
    applyTransform();
  }

  // Cursor trail
  if (cursorTrailEnabled) {
    const now = Date.now();
    if (now - lastCursorTime > 50) {
      createCursorParticle(e.clientX, e.clientY);
      lastCursorTime = now;
    }
  }
});

window.addEventListener('mouseup', () => {
  isDragging = false;
  document.body.classList.remove('grabbing');
});

// Create cursor trail particle
function createCursorParticle(x, y) {
  const particle = document.createElement('div');
  particle.className = 'cursor-particle';
  particle.style.left = x + 'px';
  particle.style.top = y + 'px';
  document.body.appendChild(particle);
  setTimeout(() => particle.remove(), 1000);
}

// Scroll zoom
container.addEventListener('wheel', (e) => {
  e.preventDefault();
  const delta = e.deltaY > 0 ? 0.92 : 1.08;
  const newScale = Math.min(Math.max(scale * delta, 0.2), 1.5);
  const rect = container.getBoundingClientRect();
  const mx = e.clientX - rect.left;
  const my = e.clientY - rect.top;
  panX = mx - (mx - panX) * (newScale / scale);
  panY = my - (my - panY) * (newScale / scale);
  scale = newScale;
  applyTransform();
}, { passive: false });

function zoomIn() {
  const cx = container.clientWidth / 2;
  const cy = container.clientHeight / 2;
  const newScale = Math.min(scale * 1.2, 1.5);
  panX = cx - (cx - panX) * (newScale / scale);
  panY = cy - (cy - panY) * (newScale / scale);
  scale = newScale;
  applyTransform();
}

function zoomOut() {
  const cx = container.clientWidth / 2;
  const cy = container.clientHeight / 2;
  const newScale = Math.max(scale * 0.8, 0.2);
  panX = cx - (cx - panX) * (newScale / scale);
  panY = cy - (cy - panY) * (newScale / scale);
  scale = newScale;
  applyTransform();
}

// Search functionality
searchInput.addEventListener('input', (e) => {
  const query = e.target.value.toLowerCase();

  nodes.forEach(node => {
    const el = document.getElementById(`node-${node.id}`);
    const matches = node.label.toLowerCase().includes(query) ||
                    node.desc.toLowerCase().includes(query) ||
                    node.tag.toLowerCase().includes(query);

    if (query && matches) {
      el.style.filter = 'brightness(1.3) drop-shadow(0 0 30px currentColor)';
      el.style.zIndex = '999';
    } else if (query) {
      el.style.filter = 'brightness(0.5) opacity(0.3)';
      el.style.zIndex = '5';
    } else {
      el.style.filter = '';
      el.style.zIndex = '';
    }
  });

  // Focus on first match
  if (query) {
    const firstMatch = nodes.find(n =>
      n.label.toLowerCase().includes(query) ||
      n.desc.toLowerCase().includes(query)
    );
    if (firstMatch) {
      focusOnNode(firstMatch);
    }
  }
});

// Focus on a specific node
function focusOnNode(node) {
  const targetX = -node.x * scale + container.clientWidth / 2;
  const targetY = -node.y * scale + container.clientHeight / 2;

  // Smooth animation
  const startX = panX;
  const startY = panY;
  const duration = 600;
  const startTime = Date.now();

  function animate() {
    const elapsed = Date.now() - startTime;
    const progress = Math.min(elapsed / duration, 1);
    const eased = 1 - Math.pow(1 - progress, 3); // ease-out cubic

    panX = startX + (targetX - startX) * eased;
    panY = startY + (targetY - startY) * eased;
    applyTransform();

    if (progress < 1) requestAnimationFrame(animate);
  }

  animate();
}

// Detail panel
function showDetail(n) {
  const colors = {
    core: 'var(--spark-gold)',
    product: 'var(--spark-amber)',
    tech: 'var(--spark-cyan)',
    revenue: 'var(--spark-flame)',
    vision: 'var(--spark-violet)',
    community: 'var(--spark-rose)',
    founder: 'var(--spark-gold)'
  };
  document.getElementById('detail-title').textContent = n.label;
  document.getElementById('detail-title').style.color = colors[n.type];
  document.getElementById('detail-body').textContent = n.detail;
  document.getElementById('detail-panel').classList.add('visible');
}

function closeDetail() {
  document.getElementById('detail-panel').classList.remove('visible');

  // Clear highlights
  highlightedNodes.forEach(id => {
    const el = document.getElementById(`node-${id}`);
    if (el) el.classList.remove('highlighted');
  });
  document.querySelectorAll('#connections line.active').forEach(l => l.classList.remove('active'));
  highlightedNodes = [];
}

document.addEventListener('click', (e) => {
  if (!e.target.closest('.node') && !e.target.closest('#detail-panel')) {
    closeDetail();
  }
});

// Keyboard shortcuts
document.addEventListener('keydown', (e) => {
  const step = 50;

  switch(e.key) {
    case 'ArrowUp':
      panY += step;
      applyTransform();
      e.preventDefault();
      break;
    case 'ArrowDown':
      panY -= step;
      applyTransform();
      e.preventDefault();
      break;
    case 'ArrowLeft':
      panX += step;
      applyTransform();
      e.preventDefault();
      break;
    case 'ArrowRight':
      panX -= step;
      applyTransform();
      e.preventDefault();
      break;
    case '+':
    case '=':
      zoomIn();
      e.preventDefault();
      break;
    case '-':
    case '_':
      zoomOut();
      e.preventDefault();
      break;
    case '/':
      searchInput.focus();
      e.preventDefault();
      break;
    case 'Escape':
      closeDetail();
      searchInput.value = '';
      searchInput.dispatchEvent(new Event('input'));
      searchInput.blur();
      break;
    case 'h':
    case 'H':
      shortcutsHint.classList.toggle('visible');
      break;
  }
});

// Floating particles (enhanced)
for (let i = 0; i < 60; i++) {
  const p = document.createElement('div');
  p.className = 'particle';
  const size = Math.random() * 4 + 1;
  p.style.width = size + 'px';
  p.style.height = size + 'px';
  p.style.left = Math.random() * 4000 + 'px';
  p.style.top = Math.random() * 3000 + 'px';

  const colors = ['rgba(240,192,64,0.2)', 'rgba(64,208,208,0.15)', 'rgba(144,96,224,0.15)', 'rgba(224,96,128,0.15)'];
  p.style.background = colors[Math.floor(Math.random() * colors.length)];
  p.style.animation = `float${i % 2 === 0 ? 'A' : 'B'} ${Math.random() * 25 + 15}s ease-in-out infinite`;
  p.style.animationDelay = Math.random() * -20 + 's';
  canvas.appendChild(p);
}

// Particle keyframes
const style = document.createElement('style');
style.textContent = `
  @keyframes floatA {
    0%, 100% { transform: translate(0, 0) rotate(0deg); opacity: 0.3; }
    25% { transform: translate(40px, -60px) rotate(90deg); opacity: 0.7; }
    50% { transform: translate(-30px, -120px) rotate(180deg); opacity: 0.3; }
    75% { transform: translate(60px, -40px) rotate(270deg); opacity: 0.6; }
  }
  @keyframes floatB {
    0%, 100% { transform: translate(0, 0) rotate(0deg); opacity: 0.2; }
    33% { transform: translate(-70px, 30px) rotate(120deg); opacity: 0.6; }
    66% { transform: translate(40px, -80px) rotate(240deg); opacity: 0.4; }
  }
`;
document.head.appendChild(style);

// Touch support (enhanced)
let lastTouchDist = 0;
let touchStartTime = 0;

container.addEventListener('touchstart', (e) => {
  touchStartTime = Date.now();

  if (e.touches.length === 1) {
    isDragging = true;
    dragStartX = e.touches[0].clientX - panX;
    dragStartY = e.touches[0].clientY - panY;
  } else if (e.touches.length === 2) {
    lastTouchDist = Math.hypot(
      e.touches[0].clientX - e.touches[1].clientX,
      e.touches[0].clientY - e.touches[1].clientY
    );
  }
});

container.addEventListener('touchmove', (e) => {
  e.preventDefault();

  if (e.touches.length === 1 && isDragging) {
    panX = e.touches[0].clientX - dragStartX;
    panY = e.touches[0].clientY - dragStartY;
    applyTransform();
  } else if (e.touches.length === 2) {
    const dist = Math.hypot(
      e.touches[0].clientX - e.touches[1].clientX,
      e.touches[0].clientY - e.touches[1].clientY
    );
    const delta = dist / lastTouchDist;
    scale = Math.min(Math.max(scale * delta, 0.2), 1.5);
    lastTouchDist = dist;
    applyTransform();
  }
}, { passive: false });

container.addEventListener('touchend', (e) => {
  isDragging = false;

  // Double tap to zoom
  const touchDuration = Date.now() - touchStartTime;
  if (touchDuration < 300 && e.changedTouches.length === 1) {
    zoomIn();
  }
});

// Initialize
setTimeout(() => {
  drawSacredGeometry();
  renderConnections();
  applyTransform();

  // Hide loading screen
  setTimeout(() => {
    loadingScreen.classList.add('hidden');

    // Show shortcuts hint briefly
    setTimeout(() => {
      shortcutsHint.classList.add('visible');
      setTimeout(() => shortcutsHint.classList.remove('visible'), 4000);
    }, 1000);
  }, 1500);
}, 100);

// Add pulse to center node
setInterval(() => {
  const coreNode = document.getElementById('node-core');
  if (coreNode) {
    createSparkles(coreNode);
  }
}, 5000);
</script>
</body>
</html>

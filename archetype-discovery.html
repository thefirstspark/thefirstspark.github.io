<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Discover Your Archetype | The Sparkverse</title>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700;900&family=Rajdhani:wght@300;400;500;600;700&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --void: #0a0a0f;
            --deep-space: #12121a;
            --nebula: #1a1a2e;
            --spark-gold: #d4af37;
            --spark-ember: #ff6b35;
            --plasma-cyan: #00fff7;
            --cosmic-violet: #9d4edd;
            --stardust: #e8e8e8;
            --ghost: rgba(255,255,255,0.05);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Rajdhani', sans-serif;
            background: var(--void);
            color: var(--stardust);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Animated Background */
        .bg-layer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
        }

        .bg-layer::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 200vmax;
            height: 200vmax;
            transform: translate(-50%, -50%);
            background: 
                radial-gradient(circle at 30% 30%, rgba(157,78,221,0.1) 0%, transparent 50%),
                radial-gradient(circle at 70% 70%, rgba(0,255,247,0.08) 0%, transparent 50%),
                radial-gradient(circle at 50% 50%, rgba(212,175,55,0.05) 0%, transparent 70%);
            animation: breathe 8s ease-in-out infinite;
        }

        @keyframes breathe {
            0%, 100% { transform: translate(-50%, -50%) scale(1); opacity: 0.8; }
            50% { transform: translate(-50%, -50%) scale(1.1); opacity: 1; }
        }

        /* Container */
        .container {
            position: relative;
            z-index: 10;
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 3rem;
        }

        .header-sigil {
            width: 80px;
            height: 80px;
            margin: 0 auto 1.5rem;
            animation: float 4s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .header-sigil svg {
            width: 100%;
            height: 100%;
            filter: drop-shadow(0 0 20px var(--spark-gold));
        }

        .header-title {
            font-family: 'Cinzel', serif;
            font-size: clamp(1.8rem, 5vw, 2.5rem);
            font-weight: 900;
            background: linear-gradient(135deg, var(--stardust), var(--spark-gold));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
        }

        .header-sub {
            font-size: 1.1rem;
            color: rgba(232,232,232,0.6);
            max-width: 500px;
            margin: 0 auto;
            line-height: 1.6;
        }

        /* Progress Bar */
        .progress-track {
            width: 100%;
            height: 4px;
            background: var(--ghost);
            border-radius: 10px;
            margin-bottom: 2rem;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--spark-gold), var(--plasma-cyan));
            border-radius: 10px;
            transition: width 0.5s ease;
            width: 0%;
        }

        .progress-text {
            text-align: center;
            font-family: 'Space Mono', monospace;
            font-size: 0.75rem;
            color: rgba(232,232,232,0.4);
            margin-bottom: 2rem;
        }

        /* Question Card */
        .question-card {
            background: linear-gradient(135deg, var(--deep-space), var(--nebula));
            border: 1px solid var(--ghost);
            border-radius: 24px;
            padding: 3rem 2rem;
            position: relative;
            overflow: hidden;
            animation: cardIn 0.5s ease;
        }

        @keyframes cardIn {
            from { opacity: 0; transform: translateY(30px) scale(0.95); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }

        .question-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--spark-gold), var(--plasma-cyan), var(--cosmic-violet));
        }

        .question-number {
            font-family: 'Space Mono', monospace;
            font-size: 0.75rem;
            color: var(--spark-gold);
            text-transform: uppercase;
            letter-spacing: 0.2em;
            margin-bottom: 1rem;
        }

        .question-text {
            font-family: 'Cinzel', serif;
            font-size: clamp(1.3rem, 4vw, 1.8rem);
            font-weight: 700;
            color: var(--stardust);
            line-height: 1.4;
            margin-bottom: 2rem;
        }

        /* Answer Options */
        .options {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .option {
            padding: 1.25rem 1.5rem;
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--ghost);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .option:hover {
            border-color: var(--spark-gold);
            background: rgba(212,175,55,0.05);
            transform: translateX(5px);
        }

        .option.selected {
            border-color: var(--spark-gold);
            background: rgba(212,175,55,0.15);
        }

        .option-marker {
            width: 24px;
            height: 24px;
            border: 2px solid var(--ghost);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            transition: all 0.3s ease;
            font-size: 0.8rem;
        }

        .option:hover .option-marker {
            border-color: var(--spark-gold);
        }

        .option.selected .option-marker {
            background: var(--spark-gold);
            border-color: var(--spark-gold);
            color: var(--void);
        }

        .option-text {
            font-size: 1.05rem;
            line-height: 1.5;
        }

        /* Navigation */
        .nav-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 2rem;
            gap: 1rem;
        }

        .nav-btn {
            padding: 1rem 2rem;
            border: none;
            border-radius: 10px;
            font-family: 'Rajdhani', sans-serif;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .nav-btn.back {
            background: transparent;
            border: 1px solid var(--ghost);
            color: var(--stardust);
        }

        .nav-btn.back:hover {
            border-color: var(--stardust);
        }

        .nav-btn.next {
            background: linear-gradient(135deg, var(--spark-gold), var(--spark-ember));
            color: var(--void);
            margin-left: auto;
        }

        .nav-btn.next:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 25px rgba(212,175,55,0.4);
        }

        .nav-btn:disabled {
            opacity: 0.3;
            cursor: not-allowed;
            transform: none !important;
        }

        /* Results Screen */
        .results-screen {
            display: none;
            text-align: center;
            animation: revealIn 1s ease;
        }

        @keyframes revealIn {
            0% { opacity: 0; }
            50% { opacity: 0; }
            100% { opacity: 1; }
        }

        .results-screen.active {
            display: block;
        }

        .reveal-flash {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--spark-gold);
            z-index: 1000;
            animation: flash 1s ease forwards;
            pointer-events: none;
        }

        @keyframes flash {
            0% { opacity: 0; }
            20% { opacity: 0.8; }
            100% { opacity: 0; display: none; }
        }

        .archetype-reveal {
            margin-bottom: 2rem;
        }

        .archetype-icon {
            font-size: 5rem;
            margin-bottom: 1rem;
            animation: iconPulse 2s ease-in-out infinite;
        }

        @keyframes iconPulse {
            0%, 100% { transform: scale(1); filter: drop-shadow(0 0 20px var(--spark-gold)); }
            50% { transform: scale(1.1); filter: drop-shadow(0 0 40px var(--spark-gold)); }
        }

        .archetype-label {
            font-family: 'Space Mono', monospace;
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.3em;
            color: var(--plasma-cyan);
            margin-bottom: 0.5rem;
        }

        .archetype-name {
            font-family: 'Cinzel', serif;
            font-size: clamp(2rem, 6vw, 3.5rem);
            font-weight: 900;
            background: linear-gradient(135deg, var(--spark-gold), var(--spark-ember), var(--cosmic-violet));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
        }

        .archetype-track {
            font-family: 'Cinzel', serif;
            font-size: 1.2rem;
            color: rgba(232,232,232,0.7);
            margin-bottom: 1rem;
        }

        .archetype-track span {
            color: var(--plasma-cyan);
        }

        .archetype-tagline {
            font-family: 'Cinzel', serif;
            font-size: 1.3rem;
            font-style: italic;
            color: var(--stardust);
            margin-bottom: 2rem;
            opacity: 0.9;
        }

        /* Result Details */
        .result-details {
            background: var(--deep-space);
            border: 1px solid var(--ghost);
            border-radius: 20px;
            padding: 2rem;
            text-align: left;
            margin-bottom: 2rem;
        }

        .detail-section {
            margin-bottom: 1.5rem;
        }

        .detail-section:last-child {
            margin-bottom: 0;
        }

        .detail-label {
            font-family: 'Space Mono', monospace;
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            color: var(--spark-gold);
            margin-bottom: 0.5rem;
        }

        .detail-content {
            font-size: 1.05rem;
            line-height: 1.6;
            color: var(--stardust);
        }

        .detail-content.highlight {
            color: var(--plasma-cyan);
            font-weight: 500;
        }

        .detail-content.warning {
            color: var(--spark-ember);
        }

        /* Shareable Title */
        .shareable-box {
            background: rgba(0,0,0,0.4);
            border: 1px dashed var(--spark-gold);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .shareable-title {
            font-family: 'Cinzel', serif;
            font-size: 1.1rem;
            color: var(--stardust);
            margin-bottom: 0.5rem;
        }

        .shareable-subtitle {
            font-size: 0.8rem;
            color: rgba(232,232,232,0.5);
        }

        .copy-btn {
            margin-top: 1rem;
            padding: 0.6rem 1.5rem;
            background: transparent;
            border: 1px solid var(--spark-gold);
            border-radius: 8px;
            color: var(--spark-gold);
            font-family: 'Rajdhani', sans-serif;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .copy-btn:hover {
            background: var(--spark-gold);
            color: var(--void);
        }

        /* Action Buttons */
        .result-actions {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .action-btn {
            padding: 1rem 2rem;
            border: none;
            border-radius: 12px;
            font-family: 'Rajdhani', sans-serif;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .action-btn.primary {
            background: linear-gradient(135deg, var(--spark-gold), var(--spark-ember));
            color: var(--void);
        }

        .action-btn.primary:hover {
            transform: scale(1.03);
            box-shadow: 0 10px 30px rgba(212,175,55,0.3);
        }

        .action-btn.secondary {
            background: var(--deep-space);
            border: 1px solid var(--ghost);
            color: var(--stardust);
        }

        .action-btn.secondary:hover {
            border-color: var(--plasma-cyan);
            color: var(--plasma-cyan);
        }

        /* Footer */
        .footer {
            text-align: center;
            padding: 2rem;
            margin-top: 2rem;
        }

        .footer-logo {
            font-family: 'Cinzel', serif;
            font-size: 1rem;
            background: linear-gradient(135deg, var(--spark-gold), var(--spark-ember));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .footer-tagline {
            font-size: 0.8rem;
            color: rgba(232,232,232,0.4);
            margin-top: 0.25rem;
        }

        /* Mobile */
        @media (max-width: 600px) {
            .container {
                padding: 1.5rem;
            }

            .question-card {
                padding: 2rem 1.5rem;
            }

            .option {
                padding: 1rem 1.25rem;
            }

            .nav-buttons {
                flex-direction: column;
            }

            .nav-btn.next {
                margin-left: 0;
                width: 100%;
                justify-content: center;
            }

            .result-actions {
                gap: 0.75rem;
            }
        }

        /* Hide during quiz */
        .quiz-container.hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="bg-layer"></div>

    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-sigil">
                <svg viewBox="0 0 100 100" fill="none">
                    <polygon points="50,5 95,75 5,75" stroke="url(#goldGrad)" stroke-width="2" fill="none"/>
                    <polygon points="50,95 5,25 95,25" stroke="url(#cyanGrad)" stroke-width="2" fill="none" opacity="0.5"/>
                    <circle cx="50" cy="50" r="15" stroke="url(#goldGrad)" stroke-width="2" fill="none"/>
                    <circle cx="50" cy="50" r="5" fill="#d4af37"/>
                    <defs>
                        <linearGradient id="goldGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" stop-color="#d4af37"/>
                            <stop offset="100%" stop-color="#ff6b35"/>
                        </linearGradient>
                        <linearGradient id="cyanGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" stop-color="#00fff7"/>
                            <stop offset="100%" stop-color="#9d4edd"/>
                        </linearGradient>
                    </defs>
                </svg>
            </div>
            <h1 class="header-title">Discover Your Archetype</h1>
            <p class="header-sub">Six questions. One identity. Find your Player Class in the Sparkverse.</p>
        </header>

        <!-- Quiz Container -->
        <div class="quiz-container" id="quiz-container">
            <div class="progress-track">
                <div class="progress-fill" id="progress-fill"></div>
            </div>
            <div class="progress-text" id="progress-text">Question 1 of 6</div>

            <div class="question-card" id="question-card">
                <div class="question-number" id="question-number">Signal Detection 01</div>
                <div class="question-text" id="question-text">Loading...</div>
                <div class="options" id="options"></div>
            </div>

            <div class="nav-buttons">
                <button class="nav-btn back" id="back-btn" onclick="prevQuestion()">
                    ‚Üê Back
                </button>
                <button class="nav-btn next" id="next-btn" onclick="nextQuestion()" disabled>
                    Continue ‚Üí
                </button>
            </div>
        </div>

        <!-- Results Screen -->
        <div class="results-screen" id="results-screen">
            <div class="archetype-reveal">
                <div class="archetype-icon" id="result-icon">‚ö°</div>
                <div class="archetype-label">Your Player Class</div>
                <div class="archetype-name" id="result-name">Signal Architect</div>
                <div class="archetype-track">on the <span id="result-track">Pathfinder</span> Track</div>
                <div class="archetype-tagline" id="result-tagline">"They see the system and redesign it."</div>
            </div>

            <div class="result-details">
                <div class="detail-section">
                    <div class="detail-label">How You Win</div>
                    <div class="detail-content highlight" id="result-wins">Synthesis ‚Üí sharing before certainty</div>
                </div>
                <div class="detail-section">
                    <div class="detail-label">Where You Get Stuck</div>
                    <div class="detail-content warning" id="result-stuck">Overthinking ‚Üí isolation</div>
                </div>
                <div class="detail-section">
                    <div class="detail-label">Your Next Move</div>
                    <div class="detail-content" id="result-move">Publish the draft, ship the map</div>
                </div>
            </div>

            <div class="shareable-box">
                <div class="shareable-title" id="shareable-title">Signal Architect ‚Ä¢ Pathfinder Track ‚Ä¢ Sparkverse Player</div>
                <div class="shareable-subtitle">Your cosmic coordinates in the simulation</div>
                <button class="copy-btn" onclick="copyTitle()">üìã Copy Title</button>
            </div>

            <div class="result-actions">
                <a href="archetype-card.html" class="action-btn primary" id="card-link">
                    üé¥ Generate Your Player Card
                </a>
                <button class="action-btn secondary" onclick="retakeQuiz()">
                    ‚Üª Retake Quiz
                </button>
                <a href="sparkverse-hub-v2.html" class="action-btn secondary">
                    üåå Enter The Sparkverse
                </a>
            </div>
        </div>

        <!-- Footer -->
        <footer class="footer">
            <div class="footer-logo">THE FIRST SPARK</div>
            <div class="footer-tagline">Reality is programmable</div>
        </footer>
    </div>

    <script>
        // ========================================
        // ARCHETYPE DISCOVERY ENGINE
        // ========================================

        // Archetype Data (Mythic Headers + Operational Bands)
        const archetypes = {
            signalArchitect: {
                name: 'Signal Architect',
                icon: 'üîÆ',
                tagline: '"They see the system and redesign it."',
                wins: 'Synthesis ‚Üí sharing before certainty',
                stuck: 'Overthinking ‚Üí isolation',
                move: 'Publish the draft, ship the map',
                traits: ['pattern', 'system', 'translate', 'foresight']
            },
            pathfinder: {
                name: 'Pathfinder',
                icon: 'üß≠',
                tagline: '"They go first so others can follow."',
                wins: 'Courage ‚Üí momentum before permission',
                stuck: 'Burnout ‚Üí lone-wolf syndrome',
                move: 'Inform before acting, then act anyway',
                traits: ['initiate', 'lead', 'break', 'independent']
            },
            pulseGenerator: {
                name: 'Pulse Generator',
                icon: '‚ö°',
                tagline: '"They power the system when aligned."',
                wins: 'Consistency ‚Üí devotion to the work',
                stuck: 'Frustration ‚Üí overcommitment',
                move: 'Say no without guilt, protect your energy',
                traits: ['build', 'sustain', 'energy', 'create']
            },
            quantumAlchemist: {
                name: 'Quantum Alchemist',
                icon: 'üî•',
                tagline: '"They turn collapse into fuel."',
                wins: 'Transmutation ‚Üí resurrection through depth',
                stuck: 'Control ‚Üí carrying emotional weight',
                move: 'Release what's already dead',
                traits: ['transform', 'depth', 'heal', 'phoenix']
            },
            bridgewalker: {
                name: 'Bridgewalker',
                icon: 'üåâ',
                tagline: '"They connect what would never meet."',
                wins: 'Empathy ‚Üí translating between worlds',
                stuck: 'People-pleasing ‚Üí self-erasure',
                move: 'State needs clearly, without apology',
                traits: ['connect', 'translate', 'harmony', 'mediate']
            },
            signalCatalyst: {
                name: 'Signal Catalyst',
                icon: '‚ú®',
                tagline: '"They wake others up by existing loudly."',
                wins: 'Ignition ‚Üí activating dormant sparks',
                stuck: 'Chaos ‚Üí unfinished loops everywhere',
                move: 'Finish one thing before starting another',
                traits: ['activate', 'inspire', 'disrupt', 'amplify']
            }
        };

        // Track options (for secondary path)
        const tracks = ['Pathfinder', 'Pulse Generator', 'Quantum Alchemist', 'Bridgewalker', 'Signal Catalyst', 'Signal Architect'];

        // Questions with weighted answers
        const questions = [
            {
                id: 1,
                label: 'Signal Detection 01',
                text: 'When you enter a room full of people, your first instinct is to...',
                options: [
                    { text: 'Map the social dynamics and figure out how the room works', scores: { signalArchitect: 3, bridgewalker: 1 } },
                    { text: 'Find someone interesting and spark a deep conversation', scores: { bridgewalker: 3, signalCatalyst: 1 } },
                    { text: 'Assess if this is worth your energy, then commit or leave', scores: { pulseGenerator: 3, pathfinder: 1 } },
                    { text: 'Feel the emotional undercurrent before anyone speaks', scores: { quantumAlchemist: 3, bridgewalker: 1 } }
                ]
            },
            {
                id: 2,
                label: 'Signal Detection 02',
                text: 'Your most natural contribution to a team is...',
                options: [
                    { text: 'Seeing what others miss and naming the real problem', scores: { signalArchitect: 3, quantumAlchemist: 1 } },
                    { text: 'Going first when no one else will', scores: { pathfinder: 3, signalCatalyst: 1 } },
                    { text: 'Doing the work that keeps everything running', scores: { pulseGenerator: 3, bridgewalker: 1 } },
                    { text: 'Getting people fired up when energy is low', scores: { signalCatalyst: 3, pathfinder: 1 } }
                ]
            },
            {
                id: 3,
                label: 'Signal Detection 03',
                text: 'When everything falls apart, you typically...',
                options: [
                    { text: 'Analyze why it happened and redesign the system', scores: { signalArchitect: 3, pulseGenerator: 1 } },
                    { text: 'Find the lesson and alchemize the pain into power', scores: { quantumAlchemist: 3, signalArchitect: 1 } },
                    { text: 'Keep showing up and doing what needs to be done', scores: { pulseGenerator: 3, pathfinder: 1 } },
                    { text: 'Rally others and find a new path forward immediately', scores: { pathfinder: 3, signalCatalyst: 1 } }
                ]
            },
            {
                id: 4,
                label: 'Signal Detection 04',
                text: 'People come to you when they need...',
                options: [
                    { text: 'Clarity on a confusing situation', scores: { signalArchitect: 3, bridgewalker: 1 } },
                    { text: 'Permission to do the scary thing', scores: { pathfinder: 3, signalCatalyst: 1 } },
                    { text: 'Help processing heavy emotions', scores: { quantumAlchemist: 3, bridgewalker: 1 } },
                    { text: 'Energy and momentum to get unstuck', scores: { signalCatalyst: 3, pulseGenerator: 1 } }
                ]
            },
            {
                id: 5,
                label: 'Signal Detection 05',
                text: 'Your biggest struggle is...',
                options: [
                    { text: 'Overthinking and not shipping until it's perfect', scores: { signalArchitect: 3, pulseGenerator: 1 } },
                    { text: 'Burning out because you don't ask for help', scores: { pathfinder: 3, pulseGenerator: 1 } },
                    { text: 'Saying yes to everything and losing yourself', scores: { bridgewalker: 3, pulseGenerator: 1 } },
                    { text: 'Starting ten things and finishing none', scores: { signalCatalyst: 3, pathfinder: 1 } }
                ]
            },
            {
                id: 6,
                label: 'Signal Detection 06',
                text: 'When you imagine your highest potential, you see yourself...',
                options: [
                    { text: 'Designing systems that change how people think', scores: { signalArchitect: 3, signalCatalyst: 1 } },
                    { text: 'Leading movements and breaking new ground', scores: { pathfinder: 3, signalCatalyst: 1 } },
                    { text: 'Building something lasting that outlives you', scores: { pulseGenerator: 3, signalArchitect: 1 } },
                    { text: 'Healing wounds and transforming pain into art', scores: { quantumAlchemist: 3, bridgewalker: 1 } }
                ]
            }
        ];

        // State
        let currentQuestion = 0;
        let answers = [];
        let scores = {
            signalArchitect: 0,
            pathfinder: 0,
            pulseGenerator: 0,
            quantumAlchemist: 0,
            bridgewalker: 0,
            signalCatalyst: 0
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            renderQuestion();
        });

        function renderQuestion() {
            const q = questions[currentQuestion];
            
            document.getElementById('question-number').textContent = q.label;
            document.getElementById('question-text').textContent = q.text;
            document.getElementById('progress-text').textContent = `Question ${currentQuestion + 1} of ${questions.length}`;
            document.getElementById('progress-fill').style.width = `${((currentQuestion) / questions.length) * 100}%`;

            const optionsHtml = q.options.map((opt, idx) => `
                <div class="option ${answers[currentQuestion] === idx ? 'selected' : ''}" 
                     onclick="selectOption(${idx})" data-index="${idx}">
                    <div class="option-marker">${answers[currentQuestion] === idx ? '‚úì' : ''}</div>
                    <div class="option-text">${opt.text}</div>
                </div>
            `).join('');

            document.getElementById('options').innerHTML = optionsHtml;
            document.getElementById('back-btn').style.visibility = currentQuestion === 0 ? 'hidden' : 'visible';
            document.getElementById('next-btn').disabled = answers[currentQuestion] === undefined;
            document.getElementById('next-btn').textContent = currentQuestion === questions.length - 1 ? 'Reveal Archetype ‚Üí' : 'Continue ‚Üí';

            // Animate card
            const card = document.getElementById('question-card');
            card.style.animation = 'none';
            card.offsetHeight; // Trigger reflow
            card.style.animation = 'cardIn 0.5s ease';
        }

        function selectOption(idx) {
            answers[currentQuestion] = idx;
            renderQuestion();
        }

        function nextQuestion() {
            if (answers[currentQuestion] === undefined) return;

            // Apply scores
            const q = questions[currentQuestion];
            const selectedOption = q.options[answers[currentQuestion]];
            Object.entries(selectedOption.scores).forEach(([key, value]) => {
                scores[key] += value;
            });

            if (currentQuestion < questions.length - 1) {
                currentQuestion++;
                renderQuestion();
            } else {
                showResults();
            }
        }

        function prevQuestion() {
            if (currentQuestion > 0) {
                // Remove scores from current answer
                if (answers[currentQuestion] !== undefined) {
                    const q = questions[currentQuestion];
                    const selectedOption = q.options[answers[currentQuestion]];
                    Object.entries(selectedOption.scores).forEach(([key, value]) => {
                        scores[key] -= value;
                    });
                }
                currentQuestion--;
                renderQuestion();
            }
        }

        function showResults() {
            // Calculate primary and secondary
            const sorted = Object.entries(scores).sort((a, b) => b[1] - a[1]);
            const primaryKey = sorted[0][0];
            const secondaryKey = sorted[1][0];

            const primary = archetypes[primaryKey];
            const secondary = archetypes[secondaryKey];

            // Flash effect
            const flash = document.createElement('div');
            flash.className = 'reveal-flash';
            document.body.appendChild(flash);
            setTimeout(() => flash.remove(), 1000);

            // Hide quiz, show results
            document.getElementById('quiz-container').classList.add('hidden');
            document.getElementById('results-screen').classList.add('active');

            // Populate results
            document.getElementById('result-icon').textContent = primary.icon;
            document.getElementById('result-name').textContent = primary.name;
            document.getElementById('result-track').textContent = secondary.name;
            document.getElementById('result-tagline').textContent = primary.tagline;
            document.getElementById('result-wins').textContent = primary.wins;
            document.getElementById('result-stuck').textContent = primary.stuck;
            document.getElementById('result-move').textContent = primary.move;

            const shareableTitle = `${primary.name} ‚Ä¢ ${secondary.name} Track ‚Ä¢ Sparkverse Player`;
            document.getElementById('shareable-title').textContent = shareableTitle;

            // Update card link with params
            document.getElementById('card-link').href = 
                `archetype-card.html?primary=${encodeURIComponent(primaryKey)}&track=${encodeURIComponent(secondaryKey)}`;

            // Save to localStorage
            localStorage.setItem('spark_archetype', JSON.stringify({
                primary: primaryKey,
                track: secondaryKey,
                scores: scores,
                timestamp: Date.now()
            }));

            // Update progress bar to full
            document.getElementById('progress-fill').style.width = '100%';
        }

        function copyTitle() {
            const title = document.getElementById('shareable-title').textContent;
            navigator.clipboard.writeText(title).then(() => {
                const btn = document.querySelector('.copy-btn');
                btn.textContent = '‚úì Copied!';
                setTimeout(() => btn.textContent = 'üìã Copy Title', 2000);
            });
        }

        function retakeQuiz() {
            currentQuestion = 0;
            answers = [];
            scores = {
                signalArchitect: 0,
                pathfinder: 0,
                pulseGenerator: 0,
                quantumAlchemist: 0,
                bridgewalker: 0,
                signalCatalyst: 0
            };
            document.getElementById('quiz-container').classList.remove('hidden');
            document.getElementById('results-screen').classList.remove('active');
            renderQuestion();
        }
    </script>
</body>
</html>
